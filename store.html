<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JINIHOME | Archive Store</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200;400;500;700&family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        /* 1. CORE ARCHITECTURE */
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        :root { 
            --bg: #FFFFFF; 
            --text: #000000; 
            --accent: #000000; 
            --border: #EEEEEE; 
            --vignette: rgba(0,0,0,0.04);
        }

        html, body {
            width: 100%; height: 100%;
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Manrope', sans-serif;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            scroll-behavior: smooth;
        }

        /* 2. INTRO LOGO FLICKER (40% OPACITY) */
        .curtain { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; 
            background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: space-between;
        }

        .bg-flicker-logo { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
            z-index: 0; pointer-events: none; 
        }

        #intro-bg-logo {
            max-width: 60vw; max-height: 50vh; object-fit: contain;
            opacity: 0.4; /* Fixed 40% Opacity */
            display: none;
        }

        /* 3. MENU BAR (BIGGER ON PHONE) */
        nav { 
            height: 90px; 
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        @media (max-width: 768px) {
            nav { height: 100px; padding: 0 20px; }
        }

        .nav-logo-card {
            background: #fff;
            padding: 8px;
            border: 1.5px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 4px 4px 0px #000;
            transition: 0.3s;
        }
        .nav-logo-card:hover { transform: translate(-2px, -2px); box-shadow: 6px 6px 0px #000; }
        
        .nav-logo-img { height: 40px; width: auto; object-fit: contain; }

        /* 4. HEADER CARD MOVEMENT (COMPLEX UI/UX) */
        .hero-card-container {
            perspective: 1000px;
        }
        .hero-card {
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            transform-style: preserve-3d;
            border: 2px solid #000;
            box-shadow: 15px 15px 0px rgba(0,0,0,0.05);
        }
        .hero-card:hover {
            transform: rotateY(-10deg) rotateX(5deg) translateZ(20px);
            box-shadow: 25px 25px 0px rgba(0,0,0,0.1);
        }

        /* 5. MARQUEE */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; width: 100%; }
        .marquee-content { display: inline-block; animation: marquee 25s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* 6. PRODUCT GRID (STRICT 2X2 ON MOBILE) */
        #product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Mobile default 2x2 */
            gap: 20px;
        }
        @media (min-width: 768px) {
            #product-grid { grid-template-columns: repeat(4, 1fr); gap: 40px; }
        }

        /* NO BLACK AND WHITE DRAMA - COLOR FORCED */
        img { grayscale: 0 !important; filter: none !important; }

        #app-content { display: block; visibility: hidden; opacity: 0; }
        #app-content.visible { visibility: visible; opacity: 1; transition: opacity 0.8s ease; }

        .vignette-bg { position: relative; background-color: #ffffff; background-image: radial-gradient(circle at 0% 0%, var(--vignette) 0%, transparent 40%), radial-gradient(circle at 100% 0%, var(--vignette) 0%, transparent 40%), radial-gradient(circle at 0% 100%, var(--vignette) 0%, transparent 40%), radial-gradient(circle at 100% 100%, var(--vignette) 0%, transparent 40%); }
        .collection-swiper { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; padding: 2rem 1.5rem; justify-items: center; }
        @media (min-width: 768px) { .collection-swiper { display: flex; justify-content: center; gap: 4rem; overflow-x: auto; } }
        .collection-circle { width: 140px; height: 140px; border-radius: 50%; overflow: hidden; border: 1px solid #000; margin-bottom: 1rem; background: #f9f9f9; }
        @media (max-width: 768px) { .collection-circle { width: 22vw; height: 22vw; } }
        .collection-card-frame.active .collection-circle { box-shadow: 0 0 0 4px #fff, 0 0 0 6px #000; transform: scale(1.05); }

        .cursor-dot { width: 8px; height: 8px; background: black; position: fixed; top: 0; left: 0; border-radius: 50%; pointer-events: none; z-index: 9999; mix-blend-difference: difference; }
        .cursor-outline { width: 40px; height: 40px; border: 1.5px solid rgba(0,0,0,1); position: fixed; top: 0; left: 0; border-radius: 50%; pointer-events: none; z-index: 9999; transition: all 0.2s ease-out; }
        .img-reveal-wrapper { overflow: hidden; position: relative; background: #fcfcfc; border: 1px solid #eee; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>

<body>

    <div class="cursor-dot hidden md:block"></div>
    <div class="cursor-outline hidden md:block"></div>

    <div id="intro-screen" class="curtain p-8 md:p-12 text-white overflow-hidden">
        <div class="bg-flicker-logo">
            <img id="intro-bg-logo" src="" alt="Flicker Logo">
        </div>

        <div class="relative flex justify-between items-start opacity-0 intro-element z-20">
            <div>
                <p class="text-[10px] font-mono text-gray-500 mb-1 uppercase tracking-widest italic">Encrypted Connection</p>
                <p id="intro-location" class="text-xs font-bold tracking-widest uppercase"></p>
            </div>
            <div class="text-right max-w-xs">
                <p class="text-[10px] font-mono text-gray-500 mb-1 uppercase tracking-widest">Global Archive</p>
                <p id="intro-desc" class="text-xs leading-relaxed text-gray-300 italic"></p>
            </div>
        </div>

        <div class="text-center w-full z-20">
            <h1 id="intro-title" class="text-[14vw] font-bold tracking-tighter uppercase mix-blend-difference">JINIHOME</h1>
        </div>

        <div class="relative intro-element opacity-0 z-20 w-full">
            <div class="flex justify-between text-[10px] font-mono text-gray-400 mb-3 tracking-[0.4em] uppercase">
                <span>Synchronizing Archive</span>
                <span id="loader-pct">0%</span>
            </div>
            <div class="w-full h-[2px] bg-white/10 relative">
                <div id="loader-bar" class="absolute left-0 top-0 h-full w-0 bg-white"></div>
            </div>
        </div>
    </div>

    <div id="app-content">
        <nav class="fixed top-0 w-full z-50 px-6 bg-white/95 backdrop-blur-xl text-black flex justify-between items-center border-b border-black">
            <a href="#" class="interactable flex items-center gap-4" id="nav-brand-container">
                <div class="nav-logo-card">
                    <img id="nav-brand-logo-img" src="" class="nav-logo-img hidden">
                </div>
                <span class="text-2xl font-bold tracking-tighter uppercase" id="nav-brand-text">JINIHOME</span>
            </a>
            
            <button onclick="toggleCart()" class="interactable flex items-center gap-4 group">
                <span class="text-[12px] font-bold uppercase tracking-[0.3em] hidden md:block">Inventory Bag</span>
                <div class="flex items-center justify-center w-10 h-10 bg-black text-white rounded-none font-bold italic" id="cart-count">0</div>
            </button>
        </nav>

        <header class="relative w-full min-h-[70vh] flex flex-col md:flex-row items-center justify-between px-6 md:px-24 bg-white pt-40 pb-20">
            <div class="w-full md:w-1/2 text-left mb-16 md:mb-0">
                <p class="text-[12px] font-bold text-black/40 mb-6 tracking-[0.8em] uppercase">Curated Drop • 2026</p>
                <h1 class="text-7xl md:text-[10vw] font-bold uppercase tracking-tighter leading-[0.8] mb-12">
                    Premium <br><span class="text-white bg-black px-6 ml-[-12px] inline-block uppercase italic">Archive</span>
                </h1>
                <button onclick="scrollToSection('products-section')" class="bg-black text-white px-14 py-6 text-[11px] font-bold uppercase tracking-[0.5em] hover:bg-gray-800 transition-all border-2 border-black">Enter Catalog</button>
            </div>
            
            <div class="hero-card-container w-full md:w-[500px]">
                <div class="hero-card w-full aspect-[4/5] bg-gray-50 overflow-hidden relative">
                    <img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover">
                </div>
            </div>
        </header>

        <div class="border-y-2 border-black py-6 bg-black text-white overflow-hidden marquee-container">
            <div class="marquee-content text-[12px] font-bold uppercase tracking-[0.6em]">
                Authenticity Guaranteed • Limited Edition Pieces • Global Logistics • Secure Checkout via WhatsApp •&nbsp;
            </div>
        </div>

        <section id="collections-section" class="py-24 border-b border-black">
            <div id="collection-track" class="collection-swiper no-scrollbar"></div>
        </section>

        <section id="products-section" class="py-24 px-6 md:px-20">
            <div class="mb-20 flex items-center justify-between sticky top-[90px] z-20 py-8 bg-white/95 backdrop-blur-md border-b-2 border-black">
                <h2 id="active-collection-title" class="text-4xl font-bold tracking-tighter uppercase italic">Inventory Archive</h2>
            </div>
            <div id="product-grid"></div>
        </section>

        <footer class="bg-black text-white py-32 text-center">
            <h2 id="footer-logo-text" class="text-7xl font-bold tracking-tighter italic mb-8 uppercase">JINIHOME</h2>
            <div class="w-20 h-1 bg-white mx-auto mb-8"></div>
            <p class="text-[10px] text-gray-500 uppercase tracking-[1em]">© 2026 ARCHIVE STOREFRONT</p>
        </footer>
    </div>

    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full md:w-[500px] bg-white z-[60] transform translate-x-full transition-transform duration-700 border-l-2 border-black flex flex-col">
        <div class="p-10 border-b-2 border-black flex justify-between items-center bg-gray-50">
            <h3 class="font-bold text-2xl uppercase tracking-tighter italic">Your Selection</h3>
            <button onclick="toggleCart()" class="text-3xl">✕</button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-10 space-y-8 no-scrollbar"></div>
        <div class="p-10 border-t-2 border-black bg-white">
            <div class="flex justify-between text-2xl font-bold mb-10 tracking-tighter"><span>Total Archive Value</span><span id="cart-total">$0.00</span></div>
            <button onclick="checkoutWhatsApp()" class="w-full py-8 bg-black text-white font-bold uppercase tracking-[0.4em] hover:invert transition-all">Secure WhatsApp Link</button>
        </div>
    </div>

    <div id="modal-overlay" class="fixed inset-0 z-[70] bg-black/98 hidden items-center justify-center p-4 opacity-0 transition-opacity duration-400">
        <div id="modal-content" class="bg-white w-full max-w-7xl h-auto md:h-[85vh] flex flex-col md:flex-row overflow-hidden border-2 border-black">
            <button onclick="closeModal()" class="absolute top-8 right-8 z-20 bg-black text-white w-12 h-12 flex items-center justify-center">✕</button>
            <div class="md:w-3/5 bg-white flex items-center justify-center p-12"><img id="modal-img" class="max-w-full max-h-full object-contain"></div>
            <div class="md:w-2/5 p-12 flex flex-col bg-white border-l-2 border-black">
                <h2 id="modal-title" class="text-5xl font-bold mb-6 uppercase italic tracking-tighter leading-none"></h2>
                <p id="modal-price" class="text-3xl font-bold mb-10 border-b-2 border-black pb-6"></p>
                <div id="modal-desc" class="text-sm text-gray-500 mb-12 leading-relaxed"></div>
                <div id="modal-variants" class="flex flex-wrap gap-4 mb-12"></div>
                <button onclick="addToCartFromModal()" class="w-full py-7 bg-black text-white font-bold uppercase tracking-[0.3em] mt-auto">Add to Archive</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://rujozgysdnaxlpqadqff.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1am96Z3lzZG5heGxwcWFkcWZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0OTY1MTUsImV4cCI6MjA4NTA3MjUxNX0.zi4FwC0xfq0brTrYs3i18rwO3hbFeVhDBq6TpLQCyVs';
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let products = [], cart = [], profile = {}, selectedVariant = null, currentProduct = null;

        window.onload = async () => {
            initCursor();
            await loadData();   
        };

        function initCursor() {
            const dot = document.querySelector('.cursor-dot'), outline = document.querySelector('.cursor-outline');
            window.addEventListener('mousemove', e => { 
                gsap.to(dot, { x: e.clientX, y: e.clientY, duration: 0.1 }); 
                gsap.to(outline, { x: e.clientX, y: e.clientY, duration: 0.3 }); 
            });
        }

        function runIntroSequence() {
            const tl = gsap.timeline();
            // FLICKER LOGO AT 40% OPACITY
            gsap.to("#intro-bg-logo", { opacity: 0.4, duration: 0.08, repeat: 25, yoyo: true, ease: "power2.inOut" });
            
            tl.to(".intro-element", { opacity: 1, duration: 0.8, stagger: 0.2 })
              .to("#loader-bar", { width: "100%", duration: 2.5, ease: "power4.inOut" })
              .to("#loader-pct", { 
                  innerHTML: "100%", duration: 2.5, snap: { innerHTML: 1 }, 
                  onUpdate: function() { this.targets()[0].innerHTML += "%" } 
              }, "<")
              .add(() => document.getElementById('app-content').classList.add('visible'))
              .to("#intro-screen", { y: "-100%", duration: 1.2, ease: "expo.inOut" });
        }

        async function loadData() {
            try {
                const path = window.location.pathname.replace(/\/+$/, '').split('/').pop();
                let q = sb.from('profiles').select('*');
                if(!path || path === 'index' || path === 'store') q = q.eq('is_published', true).limit(1);
                else q = q.eq('store_slug', path);
                
                const { data: prof } = await q.maybeSingle();
                if(prof) { profile = prof; applyBranding(); }

                const { data: prods } = await sb.from('products').select('*').eq('user_id', profile.id).order('created_at', {ascending: false});
                products = prods || [];
                renderCollections(products);
                filterCollection('All');
                runIntroSequence();
            } catch(e) { console.error("Database Sync Error:", e); }
        }

        function applyBranding() {
            const name = profile.store_name || "ARCHIVE";
            document.getElementById('nav-brand-text').innerText = name;
            document.getElementById('intro-title').innerText = name;
            document.getElementById('footer-logo-text').innerText = name;

            if(profile.logo_url) {
                const navLogo = document.getElementById('nav-brand-logo-img');
                navLogo.src = profile.logo_url;
                navLogo.classList.remove('hidden');
                
                const introLogo = document.getElementById('intro-bg-logo');
                introLogo.src = profile.logo_url;
                introLogo.style.display = 'block';
            }
            document.getElementById('intro-location').innerText = profile.location || "Online";
            document.getElementById('intro-desc').innerText = profile.description || "Premium Digital Storefront.";
        }

        function renderCollections(all) {
            const unique = ["All", ...new Set(all.map(p => p.collection || 'Standard'))];
            document.getElementById('collection-track').innerHTML = unique.map(col => {
                const cover = all.find(p => p.collection === col) || all[0];
                return `<div class="collection-card-frame ${col === 'All' ? 'active' : ''}" onclick="filterCollection('${col}')" data-col="${col}">
                    <div class="collection-circle" style="border: 2px solid #000;"><img src="${cover ? cover.images[0] : ''}" class="w-full h-full object-cover"></div>
                    <span class="text-[10px] font-bold uppercase tracking-widest text-black/40">${col}</span>
                </div>`;
            }).join('');
        }

        function filterCollection(col) {
            document.querySelectorAll('.collection-card-frame').forEach(el => el.classList.toggle('active', el.dataset.col === col));
            const filtered = col === 'All' ? products : products.filter(p => p.collection === col);
            renderProductGrid(filtered);
            document.getElementById('active-collection-title').innerText = col;
        }

        function renderProductGrid(prods) {
            document.getElementById('product-grid').innerHTML = prods.map(p => `
                <div class="interactable group cursor-pointer" onclick='openModal(${JSON.stringify(p)})'>
                    <div class="img-reveal-wrapper aspect-[3/4] mb-6 border-2 border-black relative overflow-hidden">
                        <img src="${p.images[0]}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                    </div>
                    <h4 class="font-bold uppercase text-[14px] tracking-tighter italic mb-2">${p.name}</h4>
                    <div class="flex justify-between text-[11px] font-bold uppercase tracking-widest text-black/40">
                        <span>${p.collection}</span>
                        <span class="text-black">$${p.price}</span>
                    </div>
                </div>`).join('');
        }

        function openModal(p) {
            currentProduct = p;
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-price').innerText = '$' + p.price;
            document.getElementById('modal-desc').innerText = p.description;
            document.getElementById('modal-img').src = p.images[0];
            const vDiv = document.getElementById('modal-variants');
            let vars = [];
            try { vars = typeof p.variants === 'string' ? JSON.parse(p.variants) : p.variants; } catch(e) { vars = ["Standard"]; }
            vDiv.innerHTML = (vars || ["Standard"]).map(v => `<button class="border-2 border-black px-8 py-4 text-[10px] font-bold uppercase transition-all" onclick="selectVariant(this, '${v}')">${v}</button>`).join('');
            document.getElementById('modal-overlay').classList.remove('hidden');
            setTimeout(() => document.getElementById('modal-overlay').classList.add('opacity-100'), 50);
        }

        function selectVariant(el, v) { 
            document.querySelectorAll('#modal-variants button').forEach(b => b.classList.remove('bg-black', 'text-white'));
            el.classList.add('bg-black', 'text-white');
            selectedVariant = v; 
        }

        function closeModal() { document.getElementById('modal-overlay').classList.remove('opacity-100'); setTimeout(() => document.getElementById('modal-overlay').classList.add('hidden'), 300); }
        function toggleCart() { document.getElementById('cart-sidebar').classList.toggle('translate-x-full'); renderCart(); }
        
        function renderCart() {
            const cont = document.getElementById('cart-items'); let total = 0;
            cont.innerHTML = cart.map((item, i) => {
                total += parseFloat(item.price);
                return `<div class="flex gap-6 border-b-2 border-black pb-8">
                    <img src="${item.images[0]}" class="w-20 h-24 object-cover border-2 border-black">
                    <div class="flex-1"><h4 class="font-bold text-[14px] uppercase italic">${item.name}</h4><p class="text-[10px] uppercase font-bold text-black/40">${item.variant}</p><p class="font-bold mt-2">$${item.price}</p></div>
                    <button onclick="cart.splice(${i},1);renderCart()" class="text-2xl">✕</button>
                </div>`;
            }).join('');
            document.getElementById('cart-total').innerText = '$' + total.toFixed(2);
            document.getElementById('cart-count').innerText = cart.length;
        }

        function addToCartFromModal() { if(currentProduct) { cart.push({...currentProduct, variant: selectedVariant || 'Standard'}); closeModal(); toggleCart(); } }
        function scrollToSection(id) { document.getElementById(id).scrollIntoView({behavior:'smooth'}); }
        function checkoutWhatsApp() { window.open(`https://wa.me/${profile.payment_number || '9199999999'}?text=Archive Checkout`, '_blank'); }
    </script>
</body>
</html>
