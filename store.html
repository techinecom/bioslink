<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JINIHOME | Storefront</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body class="antialiased">

    <div id="intro-screen">
        <canvas id="matrix-canvas"></canvas>
        <div class="relative z-10 flex flex-col lg:flex-row items-center gap-16 max-w-6xl px-8">
            <div class="intro-3d-card w-72 h-[420px] hidden lg:block">
                <div class="card-inner w-full h-full gradient-bg rounded-[3rem] p-1 shadow-glow">
                    <div class="w-full h-full bg-black rounded-[2.8rem] flex flex-col items-center justify-center p-8 text-center border border-white/10">
                        <div class="w-20 h-20 accent-bg rounded-full mb-6 flex items-center justify-center font-black text-4xl italic text-white">J</div>
                        <h2 class="text-white text-3xl font-black italic tracking-tighter" id="intro-store-name">JINIHOME</h2>
                        <p class="text-gray-500 text-[10px] uppercase tracking-[0.4em] mt-2">Bengaluru Series '26</p>
                    </div>
                </div>
            </div>

            <div class="text-center lg:text-left text-white space-y-8">
                <h1 class="text-5xl md:text-8xl font-black tracking-tighter leading-[0.9] mb-4" id="intro-hero-title">Architecture<br>Of <span class="accent-text">Style.</span></h1>
                <p class="text-gray-400 text-sm md:text-lg max-w-lg leading-relaxed" id="intro-subtitle">
                    Premium footwear and precision horology. Connecting local excellence with modern design.
                </p>
                <div class="pt-4">
                    <button onclick="enterSite()" class="bg-white text-black px-12 py-5 rounded-full font-black text-xs uppercase tracking-[0.2em] hover-accent transition-all duration-500 shadow-2xl active:scale-95">
                        Enter Showroom
                    </button>
                </div>
                <p class="text-[9px] text-gray-600 uppercase tracking-widest pt-4">Indiranagar • Bangalore • 2026</p>
            </div>
        </div>
    </div>

    <div id="main-wrapper">
        
        <header class="header-bg text-white pt-48 pb-32 border-b-radius-lg overflow-hidden rounded-b-[100px]">
            <nav class="fixed top-0 w-full z-50 py-6 px-8 md:px-12 bg-black/50 backdrop-blur-2xl border-b border-white/5">
                <div class="max-w-[1600px] mx-auto flex justify-between items-center">
                    <div class="text-3xl font-black tracking-tighter italic cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">
                        <span class="accent-text">.</span><span id="nav-store-name">JINIHOME</span>
                    </div>
                    <button class="flex items-center gap-4 bg-white/5 border border-white/10 px-8 py-3 rounded-full hover:bg-white/10 transition-all" onclick="openCartModal()">
                        <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Cart</span>
                        <div id="cart-count" class="w-6 h-6 accent-bg text-[10px] flex items-center justify-center rounded-full text-white font-black">0</div>
                    </button>
                </div>
            </nav>

            <div class="max-w-[1500px] mx-auto px-8 grid md:grid-cols-2 gap-20 items-center">
                <div class="space-y-10">
                    <h1 class="hero-title text-6xl md:text-9xl font-black leading-[0.85] tracking-tighter" id="main-hero-text">Style in<br><span class="accent-text">Motion.</span></h1>
                    <p class="text-gray-400 text-xl font-light max-w-md" id="main-sub-text">The pinnacle of digital shopping. Curated fashion drops from Bengaluru's elite boutiques.</p>
                </div>
                <div class="relative group">
                    <div class="absolute -inset-4 accent-blur opacity-50"></div>
                    <img id="hero-image" src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&q=80&w=1200" class="relative rounded-[4rem] shadow-2xl rotate-2 group-hover:rotate-0 transition-all duration-1000">
                </div>
            </div>
        </header>

        <section class="py-24 px-8">
            <div class="flex justify-center gap-8 md:gap-16 flex-wrap" id="categoryBox">
                <div class="category-card active group cursor-pointer text-center" onclick="advancedFilter('all', this)">
                    <div class="relative w-40 h-40 md:w-48 md:h-48 mx-auto mb-4">
                        <div class="orbit-ring"></div>
                        <div class="w-full h-full rounded-full bg-black flex items-center justify-center border-4 border-white text-white font-bold text-xs shadow-2xl">ALL</div>
                    </div>
                    <h4 class="text-[10px] font-black tracking-widest accent-text uppercase">Showroom</h4>
                </div>
            </div>
        </section>

        <section class="pb-40 px-8">
            <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-12 md:gap-16 max-w-[1500px] mx-auto min-h-[500px]">
                <div class="col-span-full text-center text-gray-400 py-20 flex flex-col items-center">
                    <div class="w-8 h-8 border-4 border-accent border-t-transparent rounded-full animate-spin mb-4"></div>
                    Loading Collection...
                </div>
            </div>
        </section>
    </div>

    <footer class="px-8 md:px-20">
        <div class="max-w-[1500px] mx-auto w-full grid md:grid-cols-3 gap-20">
            <div class="space-y-8">
                <h2 class="text-5xl font-black italic accent-text" id="footer-store-name">JINIHOME.</h2>
                <p class="text-gray-500 text-sm leading-relaxed">Elevating lifestyle through curated excellence.</p>
            </div>
            <div class="grid grid-cols-2 gap-10">
                <div class="space-y-6">
                    <h5 class="accent-text font-bold uppercase text-xs tracking-widest">Shop</h5>
                    <ul class="space-y-4 text-gray-400 text-sm">
                        <li class="hover:text-white cursor-pointer transition-colors">New Arrivals</li>
                        <li class="hover:text-white cursor-pointer transition-colors">Best Sellers</li>
                    </ul>
                </div>
                <div class="space-y-6">
                    <h5 class="accent-text font-bold uppercase text-xs tracking-widest">Support</h5>
                    <ul class="space-y-4 text-gray-400 text-sm">
                        <li class="hover:text-white cursor-pointer transition-colors">Shipping</li>
                    </ul>
                </div>
            </div>
            <div class="space-y-8">
                <h5 class="text-white font-bold uppercase text-xs tracking-widest">Newsletter</h5>
                <div class="flex border-b border-gray-800 pb-3">
                    <input type="text" placeholder="Your Email" class="bg-transparent text-sm w-full outline-none text-white">
                    <button class="accent-text font-black text-xs uppercase">Join</button>
                </div>
            </div>
        </div>
    </footer>

    <div id="productModal" class="fixed inset-0 z-[100] hidden items-center justify-center p-6 bg-black/90 backdrop-blur-md">
        <div class="bg-white rounded-[4rem] max-w-5xl w-full max-h-[90vh] overflow-hidden relative shadow-2xl flex flex-col lg:flex-row">
            <button onclick="closeModal()" class="absolute top-8 right-8 z-10 bg-black/5 hover:bg-black/10 p-4 rounded-full transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            
            <div class="lg:w-1/2 p-8 bg-gray-50 flex flex-col justify-center items-center">
                <img id="modalImgMain" class="w-full aspect-square object-cover rounded-[3rem] shadow-lg mb-8" src="">
                <div class="flex gap-4 overflow-x-auto scrollbar-hide" id="modalThumbnails"></div>
            </div>

            <div class="lg:w-1/2 p-12 flex flex-col justify-center">
                <span class="accent-text font-bold uppercase text-[10px] tracking-[0.4em] mb-4">Official Release</span>
                <h2 id="modalTitle" class="text-5xl font-black mb-2 tracking-tighter text-black">Product</h2>
                <p id="modalPrice" class="text-3xl font-black accent-text mb-8">$00</p>
                <p id="modalDesc" class="text-gray-500 leading-relaxed mb-10 text-sm">Desc</p>
                
                <div class="mb-12">
                    <h5 class="text-[10px] font-black uppercase tracking-widest mb-6 text-gray-400">Select Edition</h5>
                    <div class="flex gap-4 flex-wrap" id="variantWrapper"></div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="addToCartCurrent()" class="py-5 bg-black text-white rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-gray-800 transition-all">Add to Bag</button>
                    <button onclick="buyNowCurrent()" class="py-5 accent-bg text-white rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-glow">Buy Now</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const SUPABASE_URL = 'https://rujozgysdnaxlpqadqff.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1am96Z3lzZG5heGxwcWFkcWZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0OTY1MTUsImV4cCI6MjA4NTA3MjUxNX0.zi4FwC0xfq0brTrYs3i18rwO3hbFeVhDBq6TpLQCyVs';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let products = [], cart = [], currentModalProduct = null, selectedVariant = null, profile = null;

        // --- INIT ---
        window.onload = async function() {
            setInterval(drawMatrix, 35);
            document.body.style.overflow = 'hidden';
            await loadStoreData();
        };

        // --- HELPER TO GET THEME COLOR ---
        function getAccentColor() {
            return getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
        }

        // --- DATA LOGIC ---
        async function loadStoreData() {
            let slug = window.location.pathname.replace('/', '').replace('.html', ''); 
            if(!slug || slug.length === 0) {
                 const { data } = await _supabase.from('profiles').select('*').eq('is_published', true).limit(1);
                 if(data && data.length > 0) profile = data[0];
            } else {
                 const { data } = await _supabase.from('profiles').select('*').eq('store_slug', slug).single();
                 profile = data;
            }

            if(!profile) return;
            updateBranding(profile);

            const { data: dbProducts } = await _supabase.from('products').select('*').eq('user_id', profile.id).order('created_at', { ascending: false });
            if(dbProducts) { products = dbProducts; renderProducts(products); }
        }

        function updateBranding(profile) {
            if(profile.store_name) {
                document.getElementById('intro-store-name').innerText = profile.store_name;
                document.getElementById('nav-store-name').innerText = profile.store_name;
                document.getElementById('footer-store-name').innerText = profile.store_name + ".";
            }
            if(profile.hero_title) {
                const titleHtml = profile.hero_title.replace(/\n/g, '<br>');
                document.getElementById('intro-hero-title').innerHTML = titleHtml;
                document.getElementById('main-hero-text').innerHTML = titleHtml;
            }
            if(profile.hero_subtitle) {
                document.getElementById('intro-subtitle').innerText = profile.hero_subtitle;
                document.getElementById('main-sub-text').innerText = profile.hero_subtitle;
            }
            if(profile.header_url) document.getElementById('hero-image').src = profile.header_url;
        }

        function renderProducts(list) {
            const grid = document.getElementById('productGrid');
            if(list.length === 0) { grid.innerHTML = '<div>No products found.</div>'; return; }

            grid.innerHTML = list.map(product => {
                const img = (product.images && product.images.length > 0) ? product.images[0] : 'https://placehold.co/600';
                return `
                <div class="product-card" data-type="${product.category || 'general'}">
                    <div class="product-shell cursor-pointer" onclick='openModalWrapper(${JSON.stringify(product).replace(/'/g, "&#39;")})'>
                        <div class="aspect-square rounded-[3rem] overflow-hidden bg-[#F9F9F9] mb-8 group">
                            <img src="${img}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                        </div>
                        <div class="flex justify-between items-center px-4 mb-6">
                            <h4 class="text-2xl font-bold truncate pr-4 text-black">${product.name}</h4>
                            <p class="text-xl font-black accent-text">$${product.price}</p>
                        </div>
                        <button onclick="event.stopPropagation(); quickAdd(${product.id})" class="w-full py-5 bg-black text-white rounded-[2rem] font-bold text-[10px] uppercase tracking-widest hover-accent transition-all">Add To Bag</button>
                    </div>
                </div>`;
            }).join('');
        }

        function openModalWrapper(product) {
            currentModalProduct = product;
            selectedVariant = (product.variants && product.variants.length > 0) ? product.variants[0] : null;

            document.getElementById('modalTitle').innerText = product.name;
            document.getElementById('modalPrice').innerText = '$' + product.price;
            document.getElementById('modalDesc').innerText = product.description;
            document.getElementById('modalImgMain').src = (product.images && product.images.length > 0) ? product.images[0] : 'https://placehold.co/600';

            const thumbContainer = document.getElementById('modalThumbnails');
            thumbContainer.innerHTML = (product.images || []).map(img => `
                <img onclick="document.getElementById('modalImgMain').src=this.src" class="w-20 h-20 rounded-2xl cursor-pointer border-2 border-transparent hover-border-accent object-cover" src="${img}">
            `).join('');

            const vWrap = document.getElementById('variantWrapper');
            vWrap.innerHTML = '';
            if(product.variants && product.variants.length > 0) {
                product.variants.forEach((v, i) => {
                    const div = document.createElement('div');
                    div.innerText = v;
                    div.className = `px-6 py-2 border-2 rounded-full text-[10px] font-black cursor-pointer transition-all ${i === 0 ? 'accent-border accent-text' : 'border-gray-100 text-gray-400'}`;
                    div.onclick = function() {
                        selectedVariant = v;
                        vWrap.querySelectorAll('div').forEach(d => d.className = `px-6 py-2 border-2 rounded-full text-[10px] font-black cursor-pointer transition-all border-gray-100 text-gray-400`);
                        this.className = `px-6 py-2 border-2 rounded-full text-[10px] font-black cursor-pointer transition-all accent-border accent-text`;
                    };
                    vWrap.appendChild(div);
                });
            }
            document.getElementById('productModal').classList.replace('hidden', 'flex');
            document.body.style.overflow = 'hidden';
        }

        function addToCartCurrent() {
            if(!currentModalProduct) return;
            cart.push({ ...currentModalProduct, variant: selectedVariant });
            updateCartUI(); closeModal();
        }

        function quickAdd(id) {
            const product = products.find(p => p.id === id);
            if(product) { cart.push({ ...product, variant: 'Default' }); updateCartUI(); }
        }

        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.length;
            const btn = document.getElementById('cart-count').parentElement;
            btn.classList.add('scale-105'); setTimeout(() => btn.classList.remove('scale-105'), 200);
        }

        function buyNowCurrent() {
            if(!currentModalProduct) return;
            const msg = `Hi ${profile.store_name}, I want to buy: ${currentModalProduct.name} ($${currentModalProduct.price}). Edition: ${selectedVariant || 'Standard'}.`;
            window.open(`https://wa.me/${profile.payment_number}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        // --- MATRIX ENGINE (Using CSS Variables) ---
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // READS COLOR FROM CSS VARIABLE
            ctx.fillStyle = getAccentColor(); 
            ctx.font = fontSize + 'px monospace';
            for (let i = 0; i < drops.length; i++) {
                const text = letters[Math.floor(Math.random() * letters.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }

        function enterSite() {
            document.getElementById('intro-screen').classList.add('intro-hidden');
            document.body.style.overflow = 'auto';
        }

        function closeModal() {
            document.getElementById('productModal').classList.replace('flex', 'hidden');
            document.body.style.overflow = 'auto';
        }

        function advancedFilter(category, element) {
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('active'); card.classList.add('opacity-50');
                // Ensure text returns to grey when inactive
                card.querySelector('h4').style.color = ''; 
                card.querySelector('h4').style.color = 'var(--text-secondary)'; 
            });
            element.classList.add('active'); element.classList.remove('opacity-50');
            // Element color is handled by CSS classes now
            
            document.querySelectorAll('.product-card').forEach(card => {
                const type = card.dataset.type ? card.dataset.type.toLowerCase() : 'general';
                if (category === 'all' || type.includes(category)) card.style.display = 'block';
                else card.style.display = 'none';
            });
        }
        
        function openCartModal() {
            if(cart.length === 0) { alert("Your cart is empty."); return; }
            buyNowCurrent(); // Simplified flow
        }
    </script>
</body>
</html>
