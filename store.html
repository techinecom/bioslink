<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JINIHOME | Storefront</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* ========================================
           1. THEME & CORE VARIABLES
           ======================================== */
        :root {
            --header-bg: #0A0A0B; 
            --accent: #EA580C;
            --body-bg: #F2F3F5; 
            --card-bg: #FFFFFF;
            --text-main: #0A0A0B;
            --text-muted: #6B7280;
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.05);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--body-bg); 
            color: var(--text-main);
            margin: 0; padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3, h4, .brand-font { font-family: 'Outfit', sans-serif; }

        .accent-text { color: var(--accent) !important; }
        .accent-bg { background-color: var(--accent) !important; }
        .header-dynamic-bg { background-color: var(--header-bg) !important; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }

        /* ========================================
           2. AUTOMATED ANIMATIONS (KEYFRAMES)
           ======================================== */
        @keyframes lightOrbit {
            0% { transform: translate(-20%, -20%) scale(1); opacity: 0.1; }
            33% { transform: translate(40%, 10%) scale(1.2); opacity: 0.2; }
            66% { transform: translate(10%, 40%) scale(0.8); opacity: 0.15; }
            100% { transform: translate(-20%, -20%) scale(1); opacity: 0.1; }
        }

        @keyframes autoTilt {
            0% { transform: rotateY(0deg) rotateX(0deg) scale(1); }
            25% { transform: rotateY(4deg) rotateX(2deg) scale(1.02); }
            50% { transform: rotateY(0deg) rotateX(4deg) scale(1); }
            75% { transform: rotateY(-4deg) rotateX(2deg) scale(1.02); }
            100% { transform: rotateY(0deg) rotateX(0deg) scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* ========================================
           3. UI COMPONENTS
           ======================================== */
        #intro-screen { 
            position: fixed; inset: 0; z-index: 9999; 
            background-color: #050505; display: flex; 
            align-items: center; justify-content: center; 
            transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .intro-hidden { transform: translateY(-100%); pointer-events: none; }

        #matrix-canvas { position: absolute; inset: 0; opacity: 0.25; pointer-events: none; }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .header-section {
            position: relative; padding-top: 8rem; padding-bottom: 120px;
            background: var(--header-bg); overflow: hidden;
            border-bottom-left-radius: 60px; border-bottom-right-radius: 60px;
        }

        .header-glow {
            position: absolute; width: 600px; height: 600px;
            background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
            filter: blur(80px); pointer-events: none; z-index: 1;
            animation: lightOrbit 12s ease-in-out infinite;
        }

        .hero-image-wrapper {
            position: relative; transform-style: preserve-3d;
            animation: autoTilt 8s ease-in-out infinite;
        }

        .float-badge {
            position: absolute; backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 20px; border-radius: 20px; z-index: 20;
            animation: float 6s ease-in-out infinite;
        }

        #categoryBox { display: flex; overflow-x: auto; gap: 1.25rem; scrollbar-width: none; }
        .category-card { flex-shrink: 0; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0.7; }
        .category-card.active { opacity: 1; transform: scale(1.05); }

        .orbit-ring {
            position: absolute; inset: -6px; border: 2px solid transparent;
            border-top-color: var(--accent); border-radius: 50%;
            opacity: 0; transition: opacity 0.6s ease;
        }
        .active .orbit-ring { opacity: 1; animation: spin 4s linear infinite; }

        .product-shell {
            background: var(--card-bg); border-radius: 2rem; padding: 1rem;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            border: 1px solid rgba(0,0,0,0.04);
        }

        #cart-sidebar {
            position: fixed; top: 0; right: 0; height: 100%; width: 100%; max-width: 420px;
            background: white; z-index: 10000; transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }
        #cart-sidebar.open { transform: translateX(0); }

        /* ========================================
           4. MOBILE RESPONSIVENESS
           ======================================== */
        @media (max-width: 768px) {
            .header-section { padding-top: 6rem; padding-bottom: 60px; border-bottom-left-radius: 30px; }
            #main-hero-text { font-size: 3.5rem !important; text-align: center; }
            #productGrid { grid-template-columns: repeat(2, 1fr) !important; padding: 0 10px; }
            .hero-image-wrapper img { height: 300px !important; }
            .float-badge { scale: 0.7; }
        }
    </style>
</head>

<body class="antialiased">

    <div id="intro-screen">
        <canvas id="matrix-canvas"></canvas>
        <div class="relative z-10 glass-card w-full max-w-lg mx-4 rounded-[3.5rem] p-12 text-center space-y-8">
            <div class="w-24 h-24 mx-auto accent-bg rounded-full flex items-center justify-center font-black text-5xl italic text-white shadow-lg border-4 border-white/10">J</div>
            <div class="space-y-2">
                <h1 class="text-5xl font-black italic text-white" id="intro-store-name">JINIHOME</h1>
                <p class="text-[var(--accent)] font-bold uppercase tracking-widest text-[10px]" id="intro-store-type">Premium Experience</p>
            </div>
            <p class="text-gray-300 text-sm" id="intro-description">Syncing collection...</p>
            <button onclick="enterSite()" class="w-full bg-white text-black py-5 rounded-2xl font-black uppercase tracking-widest hover:bg-[var(--accent)] hover:text-white transition-all">Enter Showroom</button>
        </div>
    </div>

    <div id="main-wrapper">
        <header class="header-section header-dynamic-bg text-white" id="advanced-header">
            <div class="header-glow"></div>
            
            <nav id="top-nav" class="fixed top-0 w-full z-[1000] py-4 px-6 md:px-12 transition-all duration-500">
                <div class="max-w-[1500px] mx-auto flex justify-between items-center bg-white/5 backdrop-blur-xl border border-white/10 p-3 md:p-4 rounded-full">
                    <div class="text-2xl font-black italic flex gap-3 items-center cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">
                        <div class="w-3 h-3 accent-bg rounded-full shadow-lg"></div>
                        <span id="nav-store-name">JINIHOME</span>
                    </div>
                    <button class="relative bg-white/10 px-6 py-2.5 rounded-full flex items-center gap-3 font-bold text-xs uppercase" onclick="toggleCart()">
                        <span>Bag</span>
                        <div id="cart-count" class="w-6 h-6 accent-bg text-[10px] flex items-center justify-center rounded-full text-white">0</div>
                    </button>
                </div>
            </nav>

            <div class="max-w-[1500px] mx-auto px-8 grid md:grid-cols-2 gap-16 items-center relative z-10 mt-20">
                <div class="space-y-8">
                    <div class="inline-flex items-center gap-3 bg-white/5 border border-white/10 px-4 py-2 rounded-full backdrop-blur-md">
                        <span class="flex h-2 w-2 rounded-full accent-bg animate-pulse"></span>
                        <span class="text-[10px] font-bold uppercase tracking-widest text-gray-300">Collection 2026</span>
                    </div>
                    <h1 class="text-6xl md:text-9xl font-black leading-tight tracking-tighter" id="main-hero-text">Pure<br><span class="accent-text italic">Elegance.</span></h1>
                    <p class="text-gray-400 text-sm md:text-xl font-light max-w-md" id="main-sub-text">Architecture in motion.</p>
                </div>

                <div class="hero-container relative">
                    <div class="float-badge top-10 -right-5 hidden md:flex">★ Quality Certified</div>
                    <div class="hero-image-wrapper">
                        <img id="hero-image" src="" class="rounded-[3rem] md:rounded-[4.5rem] shadow-2xl w-full h-[500px] object-cover border-4 border-white/5">
                    </div>
                </div>
            </div>
        </header>

        <section class="py-12 md:py-20">
            <div id="categoryBox" class="scrollbar-hide px-6">
                <div class="category-card active cursor-pointer text-center" onclick="filterProducts('all', this)">
                    <div class="relative w-24 h-24 md:w-32 md:h-32 mx-auto mb-3">
                        <div class="orbit-ring"></div>
                        <div class="w-full h-full rounded-full bg-white border flex items-center justify-center shadow-lg relative z-10">
                            <span class="font-black text-[10px] text-black">ALL</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="pb-32 px-4 md:px-12 max-w-[1500px] mx-auto">
            <div id="productGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </section>
    </div>

    <div id="cart-overlay" onclick="toggleCart()" class="fixed inset-0 bg-black/60 z-[9000] hidden opacity-0 transition-opacity duration-300"></div>
    <div id="cart-sidebar">
        <div class="p-6 border-b flex justify-between items-center bg-white sticky top-0">
            <h3 class="font-black text-xl italic">Your Bag .</h3>
            <button onclick="toggleCart()" class="text-xl">✕</button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-6"></div>
        <div class="p-6 border-t bg-gray-50">
            <div class="flex justify-between mb-6 font-black text-xl">
                <span class="text-gray-400">Total</span>
                <span id="cart-total">$0</span>
            </div>
            <button onclick="checkoutWhatsApp()" class="w-full py-5 accent-bg text-white rounded-2xl font-black uppercase tracking-widest">Checkout on WhatsApp</button>
        </div>
    </div>

    <div id="productModal" class="fixed inset-0 z-[20000] hidden items-center justify-center p-4 bg-black/90 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] max-w-4xl w-full max-h-[90vh] overflow-hidden relative flex flex-col md:row">
            <button onclick="closeModal()" class="absolute top-6 right-6 z-20 bg-white w-10 h-10 rounded-full shadow-lg">✕</button>
            <div class="md:w-1/2 bg-gray-50 p-6 flex items-center justify-center">
                <img id="modalImg" class="w-full h-auto max-h-[400px] object-contain rounded-3xl">
            </div>
            <div class="md:w-1/2 p-8 overflow-y-auto">
                <h2 id="modalTitle" class="text-3xl font-black italic mb-4">Product</h2>
                <p id="modalPrice" class="text-2xl font-bold accent-text mb-4">$0</p>
                <p id="modalDesc" class="text-gray-500 mb-8 border-l-4 accent-border pl-4">Description...</p>
                <div id="modalVariants" class="flex flex-wrap gap-2 mb-8"></div>
                <button onclick="addToCartFromModal()" class="w-full py-4 bg-black text-white rounded-xl font-bold uppercase tracking-widest">Add to Bag</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://rujozgysdnaxlpqadqff.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1am96Z3lzZG5heGxwcWFkcWZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0OTY1MTUsImV4cCI6MjA4NTA3MjUxNX0.zi4FwC0xfq0brTrYs3i18rwO3hbFeVhDBq6TpLQCyVs';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let products = [], cart = [], profile = {};

        window.onload = async () => {
            initMatrixEffect();
            await initializeStore();
            setupAutoSync();
            initAutomatedUI();
        };

        async function initializeStore() {
            try {
                const { data } = await _supabase.from('profiles').select('*').eq('is_published', true).limit(1);
                profile = data?.[0] || {};
                if (profile.id) {
                    applyBranding(profile);
                    await fetchProducts(profile.id);
                }
            } catch (e) { console.error(e); }
        }

        async function fetchProducts(userId) {
            const { data } = await _supabase.from('products').select('*').eq('user_id', userId);
            if (data) {
                products = data;
                renderCategories(products);
                filterProducts('all');
            }
        }

        function setupAutoSync() {
            if (!profile.id) return;
            _supabase.channel('sync').on('postgres_changes', { event: '*', schema: 'public', table: 'products', filter: `user_id=eq.${profile.id}` }, fetchProducts.bind(null, profile.id)).subscribe();
            _supabase.channel('prof-sync').on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'profiles', filter: `id=eq.${profile.id}` }, (p) => applyBranding(p.new)).subscribe();
        }

        function applyBranding(data) {
            if (data.header_color) document.documentElement.style.setProperty('--header-bg', data.header_color);
            if (data.color) document.documentElement.style.setProperty('--accent', data.color);
            document.querySelectorAll('#nav-store-name, #intro-store-name, #footer-store-name').forEach(el => el.innerText = data.store_name);
            if (data.hero_title) document.getElementById('main-hero-text').innerHTML = data.hero_title;
            if (data.header_url) document.getElementById('hero-image').src = data.header_url;
            if (data.description) document.getElementById('intro-description').innerText = data.description;
        }

        function initAutomatedUI() {
            const nav = document.getElementById('top-nav');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 80) nav.querySelector('div').classList.replace('bg-white/5', 'bg-black/60');
                else nav.querySelector('div').classList.replace('bg-black/60', 'bg-white/5');
            });
        }

        function renderCategories(prods) {
            const cats = [...new Set(prods.map(p => p.category?.toLowerCase() || 'general'))];
            const container = document.getElementById('categoryBox');
            while (container.children.length > 1) container.removeChild(container.lastChild);
            cats.forEach(cat => {
                const div = document.createElement('div');
                div.className = 'category-card cursor-pointer text-center';
                div.onclick = (e) => filterProducts(cat, e.currentTarget);
                div.innerHTML = `<div class="relative w-24 h-24 md:w-32 md:h-32 mx-auto mb-3"><div class="orbit-ring"></div><div class="w-full h-full rounded-full bg-white border flex items-center justify-center shadow-lg relative z-10"><span class="font-black text-[10px] text-black uppercase">${cat}</span></div></div>`;
                container.appendChild(div);
            });
        }

        function filterProducts(cat, btn) {
            if (btn) {
                document.querySelectorAll('.category-card').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
            }
            const grid = document.getElementById('productGrid');
            const filtered = (cat === 'all') ? products : products.filter(p => p.category?.toLowerCase() === cat.toLowerCase());
            grid.innerHTML = filtered.map(p => `
                <div class="product-shell group cursor-pointer" onclick='openModal(${JSON.stringify(p).replace(/'/g, "&#39;")})'>
                    <div class="aspect-square bg-gray-50 rounded-[2rem] overflow-hidden relative shadow-inner">
                        <img src="${p.images?.[0] || ''}" class="w-full h-full object-cover group-hover:scale-110 transition-all duration-700">
                    </div>
                    <div class="mt-4"><h3 class="font-bold truncate">${p.name}</h3><p class="font-black accent-text text-xl italic">$${p.price}</p></div>
                </div>`).join('');
        }

        function enterSite() { 
            document.getElementById('intro-screen').classList.add('intro-hidden'); 
            document.body.style.overflowY = 'auto';
        }

        function initMatrixEffect() {
            const canvas = document.getElementById('matrix-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            const drops = Array(Math.floor(canvas.width/20)).fill(1);
            setInterval(() => {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent');
                drops.forEach((y, i) => {
                    ctx.fillText(String.fromCharCode(0x30A0 + Math.random()*96), i * 20, y * 20);
                    if (y * 20 > canvas.height && Math.random() > 0.975) drops[i] = 0;
                    drops[i]++;
                });
            }, 50);
        }

        function toggleCart() {
            const sidebar = document.getElementById('cart-sidebar');
            sidebar.classList.toggle('open');
            document.getElementById('cart-overlay').classList.toggle('hidden');
            renderCart();
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            let total = 0;
            container.innerHTML = cart.map((item, i) => {
                total += item.price;
                return `<div class="flex justify-between items-center"><div><p class="font-bold">${item.name}</p><p class="text-xs text-gray-400">${item.variant || 'Standard'}</p></div><p class="font-black">$${item.price}</p></div>`;
            }).join('');
            document.getElementById('cart-total').innerText = '$' + total;
        }

        function openModal(p) {
            document.getElementById('modalTitle').innerText = p.name;
            document.getElementById('modalPrice').innerText = '$' + p.price;
            document.getElementById('modalImg').src = p.images?.[0] || '';
            document.getElementById('productModal').classList.replace('hidden', 'flex');
        }

        function closeModal() { document.getElementById('productModal').classList.replace('flex', 'hidden'); }
    </script>
</body>
</html>
