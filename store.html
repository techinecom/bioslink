<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JINIHOME | Archive Store</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200;400;700&family=Manrope:wght@200;400;800&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        
        :root { 
            --bg: #ffffff; 
            --text: #000000; 
            --accent: #000000; 
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Manrope', sans-serif;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* NEXT LEVEL INTRO */
        .intro-curtain { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; 
            background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }

        .intro-text-layer {
            position: absolute;
            font-family: 'Oswald';
            font-weight: 700;
            color: white;
            font-size: 15vw;
            line-height: 1;
            letter-spacing: -0.05em;
            text-transform: uppercase;
            white-space: nowrap;
            opacity: 0;
        }

        .scan-line {
            position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            z-index: 10001;
        }

        /* LUXURY NAV */
        nav { 
            height: 80px; 
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .nav-logo-card {
            background: #000; padding: 10px; border: 1px solid #000;
            display: flex; align-items: center; justify-content: center;
        }

        /* AUTO-ANIMATED CARDS */
        .hero-card {
            border: 1px solid #000;
            box-shadow: 30px 30px 0px rgba(0,0,0,0.03);
        }

        /* PRODUCT GRID */
        #product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        @media (min-width: 768px) {
            #product-grid { grid-template-columns: repeat(4, 1fr); gap: 60px; }
        }

        .product-card { transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .product-card:hover { transform: translateY(-10px); }

        .collection-circle { 
            width: 150px; height: 150px; border-radius: 50%; 
            overflow: hidden; border: 1px solid #eee;
            transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
        }
        .collection-card-frame.active .collection-circle { 
            border: 1px solid #000; 
            transform: scale(1.1);
        }

        .marquee-content { display: inline-block; animation: marquee 30s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        #app-content { visibility: hidden; opacity: 0; }
        
        .luxury-label {
            font-size: 10px; letter-spacing: 0.4em; text-transform: uppercase; color: #888;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>

<body>

    <div id="intro-screen" class="intro-curtain">
        <div class="scan-line"></div>
        <div id="intro-layer-1" class="intro-text-layer">AUTHENTIC</div>
        <div id="intro-layer-2" class="intro-text-layer">CURATED</div>
        <div id="intro-layer-3" class="intro-text-layer" style="mix-blend-difference: difference;">JINIHOME</div>
    </div>

    <div id="app-content">
        <nav class="fixed top-0 w-full z-50 px-8 bg-white/80 backdrop-blur-2xl flex justify-between items-center">
            <div class="flex items-center gap-6">
                <div class="nav-logo-card">
                    <img id="nav-brand-logo-img" src="" class="h-6 w-auto invert hidden">
                </div>
                <span class="text-xl font-bold tracking-tighter uppercase" id="nav-brand-text">JINIHOME</span>
            </div>
            
            <button onclick="toggleCart()" class="flex items-center gap-6 group">
                <span class="luxury-label hidden md:block">Inventory</span>
                <div class="w-12 h-12 border border-black flex items-center justify-center font-bold" id="cart-count">0</div>
            </button>
        </nav>

        <header class="relative w-full min-h-screen flex flex-col md:flex-row items-center justify-between px-8 md:px-24 pt-32 pb-20 overflow-hidden">
            <div class="w-full md:w-1/2 z-10 hero-text-area">
                <p class="luxury-label mb-8">Establishment 2026</p>
                <h1 class="text-[14vw] md:text-[9vw] font-bold uppercase tracking-tighter leading-[0.8] mb-12">
                    Global <br><span class="italic font-light">Archive</span>
                </h1>
                <div class="flex gap-4">
                    <button onclick="scrollToSection('products-section')" class="bg-black text-white px-12 py-5 text-[10px] font-bold uppercase tracking-[0.3em] hover:bg-zinc-800 transition-all">Enter Catalog</button>
                </div>
            </div>
            
            <div class="w-full md:w-1/2 flex justify-center items-center mt-20 md:mt-0">
                <div class="hero-card w-[80%] md:w-[450px] aspect-[3/4] bg-zinc-50 overflow-hidden relative">
                    <img id="hero-main-img" src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover scale-110">
                </div>
            </div>
        </header>

        <div class="py-10 bg-black text-white overflow-hidden">
            <div class="marquee-content luxury-label text-white">
                Rare Finds • Verified Quality • Direct Shipping • Rare Finds • Verified Quality • Direct Shipping •&nbsp;
            </div>
        </div>

        <section id="collections-section" class="py-32 border-b border-zinc-100">
            <div class="px-8 mb-12"><p class="luxury-label">Filter by Line</p></div>
            <div id="collection-track" class="flex gap-12 px-8 overflow-x-auto no-scrollbar pb-10">
                </div>
        </section>

        <section id="products-section" class="py-32 px-8 md:px-24">
            <div class="mb-24 flex flex-col md:flex-row justify-between items-baseline gap-4">
                <h2 id="active-collection-title" class="text-6xl font-bold tracking-tighter uppercase">All Pieces</h2>
                <p class="luxury-label" id="product-count">0 items available</p>
            </div>
            <div id="product-grid"></div>
        </section>

        <footer class="bg-white text-black py-40 px-8 border-t border-zinc-100 text-center">
            <h2 id="footer-logo-text" class="text-[12vw] font-bold tracking-tighter uppercase mb-12">JINIHOME</h2>
            <p class="luxury-label">All Rights Reserved 2026</p>
        </footer>
    </div>

    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full md:w-[500px] bg-white z-[60] transform translate-x-full transition-transform duration-700 border-l border-black flex flex-col">
        <div class="p-10 flex justify-between items-center border-b border-zinc-100">
            <h3 class="font-bold text-2xl uppercase tracking-tighter">Your Bag</h3>
            <button onclick="toggleCart()" class="text-2xl">✕</button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-10 space-y-8"></div>
        <div class="p-10 border-t border-black bg-white">
            <div class="flex justify-between text-2xl font-bold mb-10 tracking-tighter"><span>Total</span><span id="cart-total">$0.00</span></div>
            <button onclick="checkoutWhatsApp()" class="w-full py-8 bg-black text-white font-bold uppercase tracking-[0.4em]">Checkout via WhatsApp</button>
        </div>
    </div>

 <script>
        const SUPABASE_URL = 'https://rujozgysdnaxlpqadqff.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1am96Z3lzZG5heGxwcWFkcWZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0OTY1MTUsImV4cCI6MjA4NTA3MjUxNX0.zi4FwC0xfq0brTrYs3i18rwO3hbFeVhDBq6TpLQCyVs';
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let products = [], cart = [], profile = {};

        window.onload = async () => {
            await loadData();
            startAutoAnimations();
        };

        async function loadData() {
            try {
                // 1. Identify Store via URL
                const path = window.location.pathname.replace(/\/+$/, '').split('/').pop();
                
                // 2. Fetch Profile
                let q = sb.from('profiles').select('*');
                if(!path || path === 'index' || path === 'store') q = q.eq('is_published', true).limit(1);
                else q = q.eq('store_slug', path);
                
                const { data: prof } = await q.maybeSingle();
                
                if(prof) {
                    profile = prof;
                    applyBranding();
                    
                    // 3. Fetch Products
                    const { data: prods } = await sb
                        .from('products')
                        .select('*')
                        .eq('user_id', profile.id)
                        .order('created_at', {ascending: false});
                        
                    products = prods || [];
                    
                    // 4. Build Interface
                    renderCollections(); // Builds the circles based on 'collections' column
                    filterCollection('All'); // Shows all items by default
                }
                
                // 5. Start The Show
                runIntro();
                
            } catch(e) { 
                console.error("Sync Error:", e); 
                runIntro(); // Run intro anyway so site isn't blank on error
            }
        }

        // --- DYNAMIC COLLECTION SYNC SCRIPT ---

async function renderCollections() {
    const track = document.getElementById('collection-track');
    if (!track) return;

    try {
        // 1. Fetch the actual categories you created in the 'collections' table
        const { data: cols, error: colError } = await sb
            .from('collections')
            .select('*')
            .order('name');

        if (colError) throw colError;

        // 2. Build the "All" button first
        let html = `
            <div class="collection-item active shrink-0 text-center cursor-pointer" onclick="filterItems('All', this)">
                <div class="collection-circle mb-4 bg-zinc-100 flex items-center justify-center font-bold border border-black/10">ALL</div>
                <p class="text-[10px] font-bold uppercase tracking-widest">All Archive</p>
            </div>
        `;

        // 3. Map through your dashboard collections (sunglasses, clothes, watches, etc.)
        html += cols.map(c => `
            <div class="collection-item shrink-0 text-center cursor-pointer" onclick="filterItems('${c.name}', this)">
                <div class="collection-circle mb-4 border border-zinc-100 overflow-hidden">
                    <img src="${c.img_url}" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/200x200?text=${c.name}'">
                </div>
                <p class="text-[10px] font-bold uppercase tracking-widest text-zinc-400">${c.name}</p>
            </div>
        `).join('');

        track.innerHTML = html;

    } catch (e) {
        console.error("Collection Sync Failed:", e);
    }
}

// 4. Robust Filtering Logic
function filterItems(categoryName, element) {
    // Visual update for circles
    document.querySelectorAll('.collection-item').forEach(item => {
        item.classList.remove('active');
        item.querySelector('p').classList.replace('text-black', 'text-zinc-400');
    });
    
    if (element) {
        element.classList.add('active');
        element.querySelector('p').classList.replace('text-zinc-400', 'text-black');
    }

    // Filter products based on the 'collections' column in your products table
    const filtered = categoryName === 'All' 
        ? products 
        : products.filter(p => p.collections && p.collections.toLowerCase().trim() === categoryName.toLowerCase().trim());

    // Update the UI
    updateProductGrid(filtered, categoryName);
}

function updateProductGrid(items, title) {
    const grid = document.getElementById('product-grid');
    const titleEl = document.getElementById('active-title');
    const countEl = document.getElementById('count-label');

    if (titleEl) titleEl.innerText = title;
    if (countEl) countEl.innerText = `${items.length} PIECES`;
    
    if (grid) {
        grid.innerHTML = items.map(p => `
            <div class="group product-card opacity-0">
                <div class="aspect-[3/4] overflow-hidden border border-zinc-100 mb-6 bg-zinc-50 relative">
                    <img src="${p.images[0]}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000">
                </div>
                <p class="text-[9px] tracking-[0.3em] uppercase text-zinc-400 mb-2">${p.collections || 'Archive'}</p>
                <h4 class="font-bold text-lg uppercase tracking-tighter">${p.name}</h4>
                <p class="font-light mt-1 text-zinc-600">$${p.price}</p>
            </div>
        `).join('');

        // Luxury entry animation
        gsap.to(".product-card", { opacity: 1, y: 0, duration: 0.8, stagger: 0.05, ease: "power2.out" });
    }
}

        function filterCollection(col) {
            // Visual Update: Highlight the active circle
            document.querySelectorAll('.collection-card-frame').forEach(el => {
                const isActive = el.dataset.col === col;
                el.classList.toggle('active', isActive);
                // Make non-active text lighter
                const text = el.querySelector('p');
                text.style.color = isActive ? '#000' : '#aaa';
            });
            
            // Logic Update: Filter the grid
            const filtered = col === 'All' ? products : products.filter(p => {
                const pCol = p.collections ? p.collections.trim() : "Standard"; // <--- KEY FIX HERE
                return pCol === col;
            });
            
            // Update Text Headers
            document.getElementById('active-collection-title').innerText = col;
            document.getElementById('product-count').innerText = `${filtered.length} PIECES`;
            
            // Render Grid
            document.getElementById('product-grid').innerHTML = filtered.map(p => `
                <div class="product-card group cursor-pointer" onclick='openModal(${JSON.stringify(p).replace(/'/g, "&#39;")})'>
                    <div class="aspect-[3/4] overflow-hidden border border-zinc-100 mb-6 bg-gray-50 relative">
                        <img src="${p.images[0]}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors duration-500"></div>
                    </div>
                    <p class="luxury-label mb-2">${p.collections || 'Archive'}</p>
                    <h4 class="font-bold text-lg uppercase tracking-tighter">${p.name}</h4>
                    <p class="font-light mt-1">$${p.price}</p>
                </div>
            `).join('');
            
            // Trigger GSAP entry animation for new items
            gsap.from(".product-card", {
                y: 30, opacity: 0, duration: 0.8, stagger: 0.1, ease: "power2.out"
            });
        }

        // --- ANIMATIONS & UTILITIES ---
        function runIntro() {
            const tl = gsap.timeline({ onComplete: () => {
                document.getElementById('app-content').style.visibility = 'visible';
                gsap.to('#app-content', { opacity: 1, duration: 1 });
            }});

            tl.to(".scan-line", { left: "100%", duration: 1.5, ease: "power4.inOut" })
              .to("#intro-layer-1", { opacity: 1, y: -20, duration: 0.6 }, "-=0.5")
              .to("#intro-layer-1", { opacity: 0, y: -40, duration: 0.4 })
              .to("#intro-layer-2", { opacity: 1, y: -20, duration: 0.6 })
              .to("#intro-layer-2", { opacity: 0, y: -40, duration: 0.4 })
              .to("#intro-layer-3", { opacity: 1, scale: 1.2, duration: 1, ease: "expo.out" })
              .to("#intro-screen", { y: "-100%", duration: 1.2, ease: "expo.inOut" });
        }

        function startAutoAnimations() {
            gsap.to(".hero-card", { y: 20, rotate: 1, duration: 4, repeat: -1, yoyo: true, ease: "sine.inOut" });
            gsap.to(".hero-text-area", { x: 10, duration: 5, repeat: -1, yoyo: true, ease: "sine.inOut" });
        }

        function applyBranding() {
            const name = profile.store_name || "JINIHOME";
            document.querySelectorAll('#nav-brand-text, #footer-logo-text, #intro-layer-3').forEach(el => el.innerText = name);
            if(profile.logo_url) {
                const navLogo = document.getElementById('nav-brand-logo-img');
                navLogo.src = profile.logo_url;
                navLogo.classList.remove('hidden');
            }
        }
        
        // Modal Logic (Simplified for Archive Feel)
        function openModal(p) {
            // You can add your modal open logic here if you want the pop-up
            // For now, let's just log it to ensure click works
            console.log("Opening", p.name);
            // If you want to use the previous modal, paste the openModal function here
        }

        function toggleCart() { document.getElementById('cart-sidebar').classList.toggle('translate-x-full'); }
        function scrollToSection(id) { document.getElementById(id).scrollIntoView({behavior:'smooth'}); }
        function checkoutWhatsApp() { window.open(`https://wa.me/${profile.payment_number || '9199999999'}?text=Archive Order`, '_blank'); }
    </script>
</body>
</html>
